##############################################################################
##                                                                          ##
##   Development config                                                     ##
##                                                                          ##
##############################################################################

dev: &dev

  core: &dev_core

    genesis: &dev_core_genesis
      # To use a canonical JSON genesis, use the 'src' key instead of 'spec'.
      # e. g.
      # src:
      #   file: genesis.json
      #   hash: bcfbfcad6cf78f2363568e76af9d6e927f71c3683aafe5e289796579792dccdb
      spec: &dev_core_genesis_spec
        initializer:
          testBalance:
            poors:        12
            richmen:      4
            richmenShare: 0.99
            useHDAddresses: True
            totalBalance: 600000000000000000
          fakeAvvmBalance:
            count: 10
            oneBalance: 100000
          avvmBalanceFactor: 1
          useHeavyDlg: True  # it's better to use heavy delegation to test it more often
          seed: 0
        blockVersionData: &dev_core_genesis_spec_blockVersionData
          scriptVersion:     0
          slotDuration:      7000
          maxBlockSize:      2000000
          maxHeaderSize:     2000000
          maxTxSize:         4096 # 4 Kb
          maxProposalSize:   700 # 700 bytes
          mpcThd:            0.01 # 1% of stake
          heavyDelThd:       0.005 # 0.5% of stake
          updateVoteThd:     0.001 # 0.1% of total stake
          updateProposalThd: 0.1 # 10% of total stake
          updateImplicit:    10 # slots
          softforkRule:
            initThd:        0.9 # 90% of total stake
            minThd:         0.6 # 60% of total stake
            thdDecrement:   0.05 # 5% of total stake
          txFeePolicy:
            txSizeLinear:
              a: 155381 # absolute minimal fees per transaction
              b: 43.946 # additional minimal fees per byte of transaction size
          unlockStakeEpoch: 18446744073709551615 # last epoch (maxBound @Word64)
        protocolConstants: &dev_core_genesis_spec_protocolConstants
          k: 2
          protocolMagic: 55550001
          vssMinTTL: 2
          vssMaxTTL: 6
        ftsSeed: "c2tvdm9yb2RhIEdndXJkYSBib3JvZGEgcHJvdm9kYSA="
        heavyDelegation: {}
        avvmDistr: {}

    dbSerializeVersion: 0
    memPoolLimitTx: 200 # mem pool will be limited to this many transactions

    # Chain quality thresholds and other constants to detect suspicious things
    nonCriticalCQBootstrap: 0.95
    criticalCQBootstrap: 0.8888
    nonCriticalCQ: 0.8
    criticalCQ: 0.654321
    criticalForkThreshold: 2 # number of blocks such that if so many blocks are
                             # rolled back, it requires immediate response
    fixedTimeCQ: 10 # Chain quality will be also calculated for this amount
                    # of seconds.
    # Mode-sensitive logging options
    webLoggingEnabled: true

  infra: &dev_infra

    # NTP slotting
    ntpResponseTimeout: 7000000 # 7 sec
    ntpPollDelay: 300000000 # 300 sec
    ntpMaxError: 120000000 # 2 mins

    # NTP checking
    timeDifferenceWarnInterval: 14400000000 # 4 hours
    timeDifferenceWarnThreshold: 5000000 # 5 sec

    neighboursSendThreshold: 2
    kademliaDumpInterval: 4
    enhancedMessageTimeout: 360 # 6 mins
    enhancedMessageBroadcast: 2
    networkWaitLogInterval: 1 # 1s

    maxReqSize: 102 # 102 bytes
    maxInvSize: 102 # 102 bytes
    maxMempoolMsgSize: 100 # 100 bytes

  update: &dev_update
    applicationName: cardano-sl
    applicationVersion: 0
    lastKnownBlockVersion:
      bvMajor: 0
      bvMinor: 0
      bvAlt: 0
    systemTag: system

  ssc: &dev_ssc
    mpcSendInterval: 10 # must be less than (2 * k * slotDuration - networkDiameter)
    mdNoCommitmentsEpochThreshold: 3
    noReportNoSecretsForEpoch1: False

  dlg: &dev_dlg
    dlgCacheParam: 500
    messageCacheTimeout: 30

  block: &dev_block
    networkDiameter: 3
    recoveryHeadersMessage: 20 # should be greater than k

  node: &dev_node
    defaultPeers: []
    networkConnectionTimeout: 2000 # ms
    conversationEstablishTimeout: 30000
    blockRetrievalQueueSize: 100
    propagationQueueSize: 100
    pendingTxResubmissionPeriod: 7 # seconds


##############################################################################
##                                                                          ##
##   Benchmarking config                                                    ##
##                                                                          ##
##############################################################################

bench: &bench
  <<: *dev

  core:
    <<: *dev_core

    genesis:
      spec:
        <<: *dev_core_genesis_spec
        initializer:
          testBalance:
            poors:        50000
            richmen:      3
            richmenShare: 0.99
            useHDAddresses: False
            totalBalance: 6000000000
          fakeAvvmBalance:
            count: 100
            oneBalance: 15000000
          avvmBalanceFactor: 1
          useHeavyDlg: False
          seed: 0
        blockVersionData:
          <<: *dev_core_genesis_spec_blockVersionData
          slotDuration:      20000
          mpcThd:            0.02 # 2% of stake
          heavyDelThd:       0.0003 # 0.03% of stake
          updateImplicit:    10000 # slots
          txFeePolicy:
            txSizeLinear:
              a: 0 # absolute minimal fees per transaction
              b: 0 # additional minimal fees per byte of transaction size
          unlockStakeEpoch: 0 # first epoch
        protocolConstants:
          <<: *dev_core_genesis_spec_protocolConstants
          k: 6
          protocolMagic: 55550007


# Default configuration is development.

default: *dev


##############################################################################
##                                                                          ##
##   Config for tests                                                       ##
##   TODO: why is it here, not in code?                                     ##
##                                                                          ##
##############################################################################

test:
  <<: *dev
  core:
    <<: *dev_core
    genesis:
      <<: *dev_core_genesis
      spec:
        <<: *dev_core_genesis_spec
        protocolConstants:
          <<: *dev_core_genesis_spec_protocolConstants
          k: 10


##############################################################################
##                                                                          ##
##   Mainnet base                                                           ##
##                                                                          ##
##############################################################################

mainnet_base: &mainnet_base
  core: &mainnet_base_core
    genesis: &mainnet_base_genesis
      spec: &mainnet_base_spec
        initializer: # set arbitrary, should be overridden
          testBalance:
            poors:        0
            richmen:      7
            richmenShare: 0.99
            useHDAddresses: True
            totalBalance: 600000000000000000
          fakeAvvmBalance:
            count: 10
            oneBalance: 100000
          avvmBalanceFactor: 1
          useHeavyDlg: True
          seed: 0
        blockVersionData: &mainnet_base_blockVersionData
          scriptVersion:     0
          slotDuration:      20000
          maxBlockSize:      2000000
          maxHeaderSize:     2000000
          maxTxSize:         4096 # 4 Kb
          maxProposalSize:   700 # 700 bytes
          mpcThd:            0.02 # 2% of stake
          heavyDelThd:       0.0003 # 0.03% of stake
          updateVoteThd:     0.001 # 0.1% of total stake
          updateProposalThd: 0.1 # 10% of total stake
          updateImplicit:    10000 # slots
          softforkRule:
            initThd:        0.9 # 90% of total stake
            minThd:         0.6 # 60% of total stake
            thdDecrement:   0.05 # 5% of total stake
          txFeePolicy:
            txSizeLinear:
              a: 155381 # absolute minimal fees per transaction
              b: 43.946 # additional minimal fees per byte of transaction size
          unlockStakeEpoch: 18446744073709551615 # last epoch (maxBound @Word64)
        protocolConstants: &mainnet_base_protocolConstants
          k: 2160
          protocolMagic: 10000000 # arbitrary protocolMagic, to be overridden in actual configs
          vssMinTTL: 2
          vssMaxTTL: 6
        ftsSeed: "dmFzYSBvcGFzYSBza292b3JvZGEgR2d1cmRhIGJvcm9kYSBwcm92b2Rh"
        heavyDelegation: {}
        # It's defined below and set for each config.
        avvmDistr: {}

    dbSerializeVersion: 0
    memPoolLimitTx: 200 # mem pool will be limited to this many transactions

    # Chain quality thresholds and other constants to detect suspicious things
    nonCriticalCQBootstrap: 0.95
    criticalCQBootstrap: 0.8888
    nonCriticalCQ: 0.8
    criticalCQ: 0.654321
    criticalForkThreshold: 3 # number of blocks such that if so many blocks are
                             # rolled back, it requires immediate response
    fixedTimeCQ: 3600 # Chain quality will be also calculated for this amount
                    # of seconds.
    # Mode-sensitive logging options
    webLoggingEnabled: true

  infra:

    # NTP slotting
    ntpResponseTimeout: 10000000           # 10 sec
    ntpPollDelay: 60000000                 # 1 min
    ntpMaxError: 120000000 # 2 mins

    # NTP checking
    timeDifferenceWarnInterval: 14400000000 # 4 hours
    timeDifferenceWarnThreshold: 5000000 # 5 sec

    neighboursSendThreshold: 2
    kademliaDumpInterval: 4
    enhancedMessageTimeout: 360 # 6 mins
    enhancedMessageBroadcast: 2
    networkWaitLogInterval: 32 # 1s

    maxReqSize: 102 # 102 bytes
    maxInvSize: 102 # 102 bytes
    maxMempoolMsgSize: 100 # 100 bytes

  update: &mainnet_base_update
    applicationName: cardano-sl
    applicationVersion: 0
    lastKnownBlockVersion:
      bvMajor: 0
      bvMinor: 1
      bvAlt: 0
    systemTag: none

  ssc:
    mpcSendInterval: 100 # must be less than (2 * k * slotDuration - networkDiameter)
    mdNoCommitmentsEpochThreshold: 3
    noReportNoSecretsForEpoch1: True

  dlg: &mainnet_base_dlg
    dlgCacheParam: 500
    messageCacheTimeout: 30

  block: &mainnet_base_block
    networkDiameter: 18
    recoveryHeadersMessage: 2200 # should be greater than k

  node: &mainnet_base_node
    defaultPeers: []
    networkConnectionTimeout: 2000
    conversationEstablishTimeout: 30000
    blockRetrievalQueueSize: 100
    propagationQueueSize: 100
    pendingTxResubmissionPeriod: 7 # seconds
